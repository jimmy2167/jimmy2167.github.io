<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BitSoley Explorer ‚Äî Futuristic</title>

<!-- Ethers & WalletConnect (UMD) -->
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

<style>
  :root{
    --bg-1: #030519;
    --bg-2: #071a3a;
    --accent-1: #6bc8ff;   /* cyan */
    --accent-2: #9b63ff;   /* violet */
    --glass: rgba(255,255,255,0.04);
    --muted: #98adc0;
    --card-radius: 14px;
    --card-pad: 14px;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    color: #e8f8ff;
  }

  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg-1),var(--bg-2));-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;overflow-x:hidden}

  /* PARTICLE CANVAS - full screen behind UI */
  #bg-canvas {
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
    z-index: -2;
    display:block;
  }
  .bg-glow {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: -1;
    background:
      radial-gradient(800px 450px at 10% 15%, rgba(155,99,255,0.06), transparent),
      radial-gradient(600px 350px at 85% 80%, rgba(107,200,255,0.04), transparent);
    filter: blur(6px) saturate(1.05);
  }

  /* App layout */
  .app {
    max-width: 1200px;
    margin: 20px auto;
    padding: 18px;
    display: grid;
    grid-template-columns: 1fr;
    gap: 16px;
    position: relative;
    z-index: 2;
  }

  /* Header */
  .header {
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    padding:14px;
    border-radius: var(--card-radius);
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border: 1px solid rgba(255,255,255,0.04);
    box-shadow: 0 10px 40px rgba(3,10,30,0.6);
    backdrop-filter: blur(8px);
  }
  .brand { font-weight:800; font-size:1.15rem; background: linear-gradient(90deg,var(--accent-1),var(--accent-2)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; letter-spacing:0.6px; }
  .subtle { color:var(--muted); font-size:13px; }

  /* controls area */
  .controls { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  .input {
    min-width:220px;
    padding:10px 12px;
    border-radius:10px;
    background:transparent;
    border:1px solid rgba(255,255,255,0.03);
    color:inherit; outline:none;
  }
  .btn {
    padding:10px 12px;
    border-radius:10px;
    border:1px solid rgba(255,255,255,0.04);
    background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    color:var(--accent-1);
    font-weight:700;
    cursor:pointer;
  }
  .btn.primary { background: linear-gradient(90deg,var(--accent-1),var(--accent-2)); color:#051124; box-shadow: 0 8px 30px rgba(107,200,255,0.08); }

  /* summary grid */
  .summary { display:grid; grid-template-columns: repeat(3,1fr); gap:12px; }
  .card {
    padding: var(--card-pad);
    border-radius:var(--card-radius);
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.02);
  }
  .stat { font-weight:800; font-size:18px; margin-top:6px; }

  /* blocks list */
  .blocks-wrap { margin-top:6px; display:grid; gap:12px; }
  .block-card {
    display:flex;
    justify-content:space-between;
    gap:12px;
    align-items:center;
    padding:12px;
    border-radius:12px;
    background: linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
    border: 1px solid rgba(255,255,255,0.02);
    transition: transform .18s ease, box-shadow .18s ease, opacity .25s;
    opacity: 0;
    transform: translateY(10px);
  }
  .block-card.visible { opacity:1; transform: translateY(0); box-shadow: 0 12px 40px rgba(11,32,60,0.5); }
  .block-info { display:flex; gap:12px; align-items:center; flex:1; min-width:0; }
  .pill { padding:8px 10px; border-radius:10px; font-weight:800; background: linear-gradient(90deg,var(--accent-1),var(--accent-2)); color:#07102b; }
  .mono { font-family: ui-monospace, monospace; color:#bfeff8; font-size:13px; word-break:break-all; }
  .small { font-size:13px; color:var(--muted); }

  /* floating sidebar */
  .sidebar {
    position: fixed;
    right: 18px;
    top: 120px;
    width:72px;
    display:flex;
    flex-direction:column;
    gap:10px;
    z-index: 4;
  }
  .side-btn {
    width:72px; height:72px; border-radius:12px; display:flex; align-items:center; justify-content:center;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border: 1px solid rgba(255,255,255,0.03); cursor:pointer; color:var(--accent-1);
  }
  .side-btn:hover { transform: translateY(-6px); box-shadow:0 18px 60px rgba(107,200,255,0.06); }

  /* detail panel */
  .detail { margin-top:12px; }

  /* responsive */
  @media (max-width:960px) {
    .summary { grid-template-columns: 1fr; }
    .sidebar { right: 12px; top: auto; bottom: 12px; flex-direction:row; width:auto; padding:6px; background:transparent; }
    .side-btn{ width:48px; height:48px; border-radius:10px }
  }

  /* small flourish */
  .fade-in { animation: fadeInUp .45s ease both; }
  @keyframes fadeInUp { from { opacity:0; transform:translateY(10px) } to { opacity:1; transform:translateY(0) } }
</style>
</head>
<body>

<canvas id="bg-canvas" aria-hidden="true"></canvas>
<div class="bg-glow" aria-hidden="true"></div>

<div class="app" role="main">
  <header class="header" role="banner" aria-label="Explorer header">
    <div>
      <div class="brand">üöÄ BitSoley Explorer</div>
      <div class="small">Futuristic ¬∑ RPC: <span id="rpcHost">‚Äî</span> ¬∑ Chain: <span id="chainId">‚Äî</span></div>
    </div>

    <div class="controls" role="search">
      <input id="searchInput" class="input" placeholder="Search tx / address / block (paste hash or number)" aria-label="Search" />
      <button id="searchBtn" class="btn">Search</button>
      <button id="connectBtn" class="btn primary" title="Connect wallet"><i class="fa fa-wallet" aria-hidden="true"></i>&nbsp;<span id="connectLabel">Connect</span></button>
    </div>
  </header>

  <div class="summary" aria-hidden="false">
    <div class="card">
      <div class="small">Latest Block</div>
      <div id="latestBlock" class="stat">‚Äî</div>
    </div>
    <div class="card">
      <div class="small">Node</div>
      <div id="nodeStatus" class="stat">Connecting‚Ä¶</div>
    </div>
    <div class="card">
      <div class="small">Wallet</div>
      <div id="walletStatus" class="stat">Not connected</div>
    </div>
  </div>

  <section class="card" style="margin-top:10px;">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <h3 style="margin:0">Latest Blocks</h3>
      <div style="display:flex;gap:8px;">
        <button id="prevPage" class="btn">Prev</button>
        <button id="nextPage" class="btn">Next</button>
      </div>
    </div>

    <div id="blocks" class="blocks-wrap" aria-live="polite" style="margin-top:12px">
      <div class="small">Loading blocks‚Ä¶</div>
    </div>
  </section>

  <div id="detail" class="detail"></div>
</div>

<!-- Floating sidebar for add-network / socials -->
<div class="sidebar" aria-hidden="false">
  <div class="side-btn" id="addNetworkBtn" title="Add network to wallet" aria-label="Add network">‚ûï</div>
  <a class="side-btn" href="https://bitsoley.com" target="_blank" rel="noopener" title="Main site">üåê</a>
  <a class="side-btn" href="https://twitter.com/bitsoley" target="_blank" rel="noopener" title="Twitter">üê¶</a>
</div>

<script>
/* ================= CONFIG ================= */
const RPC_BASE = 'https://rpc.bitsoley.com';
const CHAIN_ID_DEC = 216721;
const CHAIN_ID_HEX = '0x34e91';
const SYMBOL = 'BSO';
const PAGE_SIZE = 10;
const POLL_MS = 6000;
/* ========================================== */

/* ethers provider */
const provider = new ethers.providers.JsonRpcProvider(RPC_BASE);

/* DOM refs */
const rpcHostEl = document.getElementById('rpcHost');
const chainIdEl = document.getElementById('chainId');
const latestBlockEl = document.getElementById('latestBlock');
const nodeStatusEl = document.getElementById('nodeStatus');
const walletStatusEl = document.getElementById('walletStatus');
const blocksContainer = document.getElementById('blocks');
const detailEl = document.getElementById('detail');
const connectLabel = document.getElementById('connectLabel');

rpcHostEl.innerText = (()=>{ try{return new URL(RPC_BASE).hostname}catch(e){return RPC_BASE}})();
chainIdEl.innerText = CHAIN_ID_DEC;

/* small helpers: BigNumber-safe conversions */
function toNumberSafe(v){
  if (v === null || v === undefined) return 0;
  if (typeof v === 'number') return v;
  if (typeof v === 'string') {
    const n = Number(v);
    return isNaN(n) ? v : n;
  }
  // ethers BigNumber-like
  if (v.toNumber) {
    try { return v.toNumber(); } catch(e){ return Number(v.toString()); }
  }
  return Number(v);
}

/* base path detection for GitHub Pages vs root */
function getBasePath(){
  // keep compatible with /explorer/ hosting
  const p = window.location.pathname;
  if (p.startsWith('/explorer/')) return '/explorer';
  if (p.startsWith('/bitsoley/explorer/')) return '/bitsoley/explorer'; // fallback example
  return '';
}

/* ================= PARTICLES (INLINE) =================
   lightweight canvas particle field ‚Äî interactive via parallax,
   but no click events (user asked for non-clickable background)
   ====================================================== */
(function initParticles(){
  const canvas = document.getElementById('bg-canvas');
  const ctx = canvas.getContext('2d');
  let width = canvas.width = innerWidth;
  let height = canvas.height = innerHeight;
  let mouseX = width / 2, mouseY = height / 2;
  const particleCount = Math.max(40, Math.round((width * height) / 70000));
  const particles = [];

  window.addEventListener('resize', ()=>{ width = canvas.width = innerWidth; height = canvas.height = innerHeight; });

  // simple particle constructor
  function P(x,y,r,s,dx,dy, hueShift){
    this.x = x; this.y = y; this.r = r; this.s = s;
    this.dx = dx; this.dy = dy; this.h = hueShift;
  }
  P.prototype.step = function(dt){
    // subtle attraction to center + mouse parallax
    const cx = width/2, cy = height/2;
    const ax = (cx - this.x) * 0.0008;
    const ay = (cy - this.y) * 0.0008;
    this.dx += ax * dt; this.dy += ay * dt;
    // small mouse parallax
    const mx = (mouseX - width/2) * 0.0006;
    const my = (mouseY - height/2) * 0.0006;
    this.dx += mx * (this.r*0.1) * dt;
    this.dy += my * (this.r*0.1) * dt;

    this.x += this.dx * dt;
    this.y += this.dy * dt;

    // wrap
    if (this.x < -50) this.x = width + 50;
    if (this.x > width + 50) this.x = -50;
    if (this.y < -50) this.y = height + 50;
    if (this.y > height + 50) this.y = -50;
  };

  function makeParticles(){
    particles.length = 0;
    for (let i=0;i<particleCount;i++){
      const x = Math.random()*width;
      const y = Math.random()*height;
      const r = 0.6 + Math.random()*2.6;
      const s = 0.3 + Math.random()*0.8;
      const dx = (Math.random()-0.5) * 0.03;
      const dy = (Math.random()-0.5) * 0.03;
      const hue = (Math.random()*70) + 190; // cyan-blue-violet range
      particles.push(new P(x,y,r,s,dx,dy,hue));
    }
  }
  makeParticles();

  // mouse movement for parallax
  window.addEventListener('mousemove', (e)=>{ mouseX = e.clientX; mouseY = e.clientY; });

  let last = performance.now();
  function frame(now){
    const dt = Math.min(60, now - last) * 0.06; // normalized delta
    last = now;
    ctx.clearRect(0,0,width,height);

    // soft gradient background overlay (subtle)
    const g = ctx.createLinearGradient(0,0,width,height);
    g.addColorStop(0, 'rgba(10,20,40,0.06)');
    g.addColorStop(1, 'rgba(0,6,20,0.12)');
    ctx.fillStyle = g;
    ctx.fillRect(0,0,width,height);

    // draw particles
    for (let p of particles){
      p.step(dt);
      const grd = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, 18);
      const hue = p.h;
      grd.addColorStop(0, `hsla(${hue},95%,65%,${0.9 * p.s})`);
      grd.addColorStop(0.4, `hsla(${hue+20},95%,58%,${0.28 * p.s})`);
      grd.addColorStop(1, `rgba(10,12,30,0)`);
      ctx.beginPath();
      ctx.fillStyle = grd;
      ctx.arc(p.x, p.y, p.r*6, 0, Math.PI*2);
      ctx.fill();
    }

    // soft connecting lines between close particles
    ctx.lineWidth = 0.6;
    for (let i=0;i<particles.length;i++){
      for (let j=i+1;j<particles.length;j++){
        const a = particles[i], b = particles[j];
        const dx = a.x - b.x, dy = a.y - b.y;
        const d2 = dx*dx + dy*dy;
        if (d2 < 9000){ // threshold
          const alpha = 0.16 * (1 - (d2/9000));
          ctx.strokeStyle = `rgba(107,200,255,${alpha})`;
          ctx.beginPath();
          ctx.moveTo(a.x, a.y);
          ctx.lineTo(b.x, b.y);
          ctx.stroke();
        }
      }
    }

    requestAnimationFrame(frame);
  }
  requestAnimationFrame(frame);
  // re-init on big resizes
  window.addEventListener('resize', ()=>{ makeParticles(); });
})();
/* ================= end particles ================== */

/* state */
let latestKnown = 0, pageStart = 0, pollHandle = null;

/* load blocks and render */
async function loadBlocks(startBlock = null){
  try {
    const bn = await provider.getBlockNumber();
    latestKnown = toNumberSafe(bn);
    latestBlockEl.innerText = latestKnown;
    nodeStatusEl.innerText = 'Online';
    if (startBlock === null) startBlock = latestKnown;
    pageStart = startBlock;

    const from = pageStart;
    const to = Math.max(0, pageStart - PAGE_SIZE + 1);

    // fetch blocks in parallel (with transactions to show quick preview)
    const tasks = [];
    for (let b = from; b >= to; b--) tasks.push(provider.getBlockWithTransactions(b).catch(()=>null));
    const blocks = await Promise.all(tasks);

    blocksContainer.innerHTML = '';
    let idx = 0;
    for (const bl of blocks){
      if (!bl) continue;
      idx++;
      const num = toNumberSafe(bl.number);
      const ts = bl.timestamp ? new Date(toNumberSafe(bl.timestamp) * 1000).toLocaleString() : '‚Äî';
      const txCount = (bl.transactions && bl.transactions.length) ? bl.transactions.length : 0;
      // create card
      const card = document.createElement('div');
      card.className = 'block-card';
      card.innerHTML = `
        <div class="block-info">
          <div class="pill">#${num}</div>
          <div style="min-width:0">
            <div style="font-weight:800; font-size:14px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap">${(bl.hash||'').slice(0,28)}‚Ä¶</div>
            <div class="small" style="margin-top:6px">${txCount} tx ¬∑ ${ts}</div>
          </div>
        </div>
        <div style="text-align:right;min-width:220px">
          <div class="mono" style="font-size:13px">${shortAddr(bl.miner)}</div>
          <div style="margin-top:8px">
            <button class="btn viewBlock" data-block="${num}">Open</button>
            <button class="btn" style="margin-left:8px" data-preview="${num}">Preview</button>
          </div>
        </div>
      `;
      // append (staggered animation)
      blocksContainer.appendChild(card);
      setTimeout(()=>card.classList.add('visible'), 70 * idx);

      // click handlers: prefer query-param links for GH Pages
      card.querySelector('.viewBlock').addEventListener('click', (ev)=>{
        ev.stopPropagation();
        const n = ev.currentTarget.getAttribute('data-block');
        window.location.href = `${getBasePath()}/block/?number=${n}`;
      });
      // preview toggles detail panel
      card.querySelector('button[data-preview]').addEventListener('click', async (ev)=>{
        ev.stopPropagation();
        const n = ev.currentTarget.getAttribute('data-preview');
        await showBlockPreview(n, bl);
      });
      // clicking card goes to block page
      card.addEventListener('click', ()=> {
        window.location.href = `${getBasePath()}/block/?number=${num}`;
      });
    }
  } catch (err) {
    console.error('loadBlocks', err);
    nodeStatusEl.innerText = 'Offline';
    blocksContainer.innerHTML = `<div class="small" style="color:#ff9b9b">Error loading blocks: ${err.message}</div>`;
  }
}

/* short address helper */
function shortAddr(s){
  if (!s) return '‚Äî';
  if (s.length > 14) return s.slice(0,8) + '‚Ä¶' + s.slice(-6);
  return s;
}

/* show small preview of block in detail area */
async function showBlockPreview(n, preFetched = null){
  try {
    detailEl.innerHTML = `<div class="card"><div class="small">Loading block ${n}‚Ä¶</div></div>`;
    let block = preFetched;
    if (!block) block = await provider.getBlockWithTransactions(Number(n));
    if (!block) { detailEl.innerHTML = `<div class="card small" style="color:#ff9b9b">Block not found</div>`; return; }
    const num = toNumberSafe(block.number);
    const ts = block.timestamp ? new Date(toNumberSafe(block.timestamp)*1000).toLocaleString() : '‚Äî';
    const gasUsed = block.gasUsed ? block.gasUsed.toString() : '‚Äî';
    const gasLimit = block.gasLimit ? block.gasLimit.toString() : '‚Äî';
    const txHtml = (block.transactions && block.transactions.length) ? block.transactions.slice(0,6).map(tx=> {
      const value = tx.value ? ethers.utils.formatEther(tx.value) : '0';
      return `<div style="padding:8px;border-radius:8px;background:rgba(255,255,255,0.01);margin-bottom:8px;display:flex;justify-content:space-between;align-items:center">
                <div style="min-width:0">
                  <div class="mono">${tx.hash}</div>
                  <div class="small" style="margin-top:6px">${shortAddr(tx.from)} ‚Üí ${tx.to ? shortAddr(tx.to) : '‚Äî'}</div>
                </div>
                <div style="text-align:right">
                  <div style="font-weight:800">${Number(value).toFixed(6)} ${SYMBOL}</div>
                  <div style="margin-top:6px"><button class="btn" onclick="window.location.href='${getBasePath()}/tx/?hash=${tx.hash}'">View</button></div>
                </div>
              </div>`;
    }).join('') : '<div class="small">No transactions</div>';

    detailEl.innerHTML = `
      <div class="card">
        <div style="display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap">
          <div style="flex:1;min-width:0">
            <div class="small">Block</div><div style="font-weight:800;margin-top:6px">${num}</div>
            <div class="small" style="margin-top:8px">Hash</div><div class="mono" style="margin-top:6px">${block.hash}</div>
            <div class="small" style="margin-top:8px">Timestamp</div><div style="margin-top:6px">${ts}</div>
          </div>
          <div style="width:260px;text-align:right">
            <div class="small">Miner</div><div class="mono" style="margin-top:6px">${block.miner}</div>
            <div style="margin-top:8px"><button class="btn" onclick="navigator.clipboard.writeText('${block.hash}').then(()=>alert('Copied'))">Copy Hash</button>
            <button class="btn" onclick="window.open('${window.location.origin + getBasePath()}/block/?number=${num}')">Open</button></div>
          </div>
        </div>
        <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.04)" />
        <div class="small">Summary</div>
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:8px">
          <div class="small">Gas Used<div style="font-weight:800">${gasUsed}</div></div>
          <div class="small">Gas Limit<div style="font-weight:800">${gasLimit}</div></div>
          <div class="small">Tx Count<div style="font-weight:800">${(block.transactions?block.transactions.length:0)}</div></div>
        </div>
        <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.04)" />
        <div class="small">Transactions</div>
        <div style="margin-top:8px">${txHtml}</div>
      </div>
    `;
  } catch (e) {
    console.error('preview error', e);
    detailEl.innerHTML = `<div class="card small" style="color:#ff9b9b">Error: ${(e.message||e)}</div>`;
  }
}

/* search routing using query params for GH pages compatibility */
function handleSearch(q){
  q = (q||'').trim();
  if (!q) return;
  if (/^\d+$/.test(q)){ window.location.href = `${getBasePath()}/block/?number=${q}`; return; }
  if (/^0x[0-9a-fA-F]{64}$/.test(q)){ window.location.href = `${getBasePath()}/tx/?hash=${q}`; return; }
  if (/^0x[0-9a-fA-F]{40}$/.test(q)){ window.location.href = `${getBasePath()}/address/?addr=${q}`; return; }
  alert('Unsupported search format. Use block number, tx hash, or address.');
}
document.getElementById('searchBtn').addEventListener('click', ()=> handleSearch(document.getElementById('searchInput').value));
document.getElementById('searchInput').addEventListener('keydown', e=>{ if (e.key === 'Enter') handleSearch(e.target.value); });

/* pagination */
document.getElementById('nextPage').addEventListener('click', async ()=>{ const candidate = Math.max(0, pageStart - PAGE_SIZE); await loadBlocks(candidate); });
document.getElementById('prevPage').addEventListener('click', async ()=>{ const cand = Math.min(latestKnown, pageStart + PAGE_SIZE); await loadBlocks(cand); });

/* wallet connect (MetaMask + WalletConnect v1) */
let walletProvider = null, signer = null, walletAddress = null;
async function connectWallet(){
  if (window.ethereum){
    try {
      await window.ethereum.request({ method: 'eth_requestAccounts' });
      walletProvider = new ethers.providers.Web3Provider(window.ethereum);
      signer = walletProvider.getSigner();
      walletAddress = await signer.getAddress();
      connectLabel.innerText = shortAddr(walletAddress);
      walletStatusEl.innerText = shortAddr(walletAddress);
    } catch (e) {
      console.error('connect', e);
      alert('Connection failed: '+(e.message||e));
    }
    return;
  }
  // WalletConnect fallback
  try{
    const wc = new window.WalletConnectProvider.default({ rpc: { [CHAIN_ID_DEC]: RPC_BASE }, qrcode: true });
    await wc.enable();
    walletProvider = new ethers.providers.Web3Provider(wc);
    signer = walletProvider.getSigner();
    walletAddress = await signer.getAddress();
    connectLabel.innerText = shortAddr(walletAddress);
    walletStatusEl.innerText = shortAddr(walletAddress);
    wc.on('disconnect', ()=>{ walletProvider=null; signer=null; walletAddress=null; connectLabel.innerText='Connect'; walletStatusEl.innerText='Not connected'; });
  }catch(e){ console.error('wc', e); alert('WalletConnect failed: '+(e.message||e)); }
}
document.getElementById('connectBtn').addEventListener('click', connectWallet);

/* add network (MetaMask) */
async function addNetwork(){
  if (!window.ethereum) return alert('Install MetaMask to add the network');
  try{
    await window.ethereum.request({
      method:'wallet_addEthereumChain',
      params:[{
        chainId: CHAIN_ID_HEX,
        chainName: 'BitSoley',
        rpcUrls: [RPC_BASE],
        nativeCurrency: { name: 'BitSoley', symbol: SYMBOL, decimals: 18 },
        blockExplorerUrls: [ window.location.origin + getBasePath() ]
      }]
    });
    alert('Network added or requested by wallet');
  }catch(e){
    console.error('addNetwork', e);
    alert('Add network failed: ' + (e.message||e));
  }
}
document.getElementById('addNetworkBtn').addEventListener('click', addNetwork);

/* utilities */
function short(s){ return s ? (s.slice(0,6) + '‚Ä¶' + s.slice(-4)) : ''; }

/* polling */
let pollHandle = null;
function startPoll(){
  if (pollHandle) return;
  pollHandle = setInterval(async ()=>{
    try{
      const bn = await provider.getBlockNumber();
      const nbn = toNumberSafe(bn);
      if (nbn > latestKnown) await loadBlocks();
      latestKnown = nbn;
    }catch(e){ console.warn('poll', e); nodeStatusEl.innerText = 'Offline'; }
  }, POLL_MS);
}
function stopPoll(){ if (pollHandle){ clearInterval(pollHandle); pollHandle = null; } }

/* boot */
(async function boot(){
  await loadBlocks();
  startPoll();
})();
</script>

</body>
</html>
