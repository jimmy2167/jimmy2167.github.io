<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BitSoley DEX</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Ethers.js -->
  <script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.min.js"></script>
  <!-- Futuristic fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Orbitron', sans-serif;
      background: radial-gradient(circle at top left, #0f0f1a, #1a1a2e);
      color: #e0e0ff;
    }
    .glass {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 0 20px rgba(0,0,0,0.6);
    }
    button {
      transition: all 0.3s ease;
    }
    button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px #00ffff;
    }
    input {
      background: rgba(255,255,255,0.1);
      border: 1px solid #00ffff55;
      color: #fff;
      padding: 0.5rem;
      border-radius: 8px;
      outline: none;
    }
    input:focus {
      border-color: #00ffff;
      box-shadow: 0 0 10px #00ffff;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-start py-12">

  <header class="text-center mb-12">
    <h1 class="text-5xl font-bold text-cyan-400 mb-2">BitSoley DEX</h1>
    <p class="text-cyan-200">Trade BSO ↔ WBSO seamlessly on your own chain</p>
  </header>

  <main class="w-full max-w-3xl flex flex-col gap-8">

    <!-- Wallet -->
    <div class="glass flex flex-col items-center p-6">
      <button id="connectWalletBtn" class="px-8 py-3 bg-blue-600 text-white rounded-lg font-bold text-lg">Connect Wallet</button>
      <p class="mt-3">Connected: <span id="walletAddress" class="font-mono text-cyan-300">Not connected</span></p>
    </div>

    <!-- Swap -->
    <div class="glass p-6 flex flex-col gap-4">
      <h2 class="text-2xl font-bold text-purple-400 mb-2">Swap Tokens</h2>
      <input type="number" id="swapAmount" placeholder="Amount to swap" />
      <button id="swapBtn" class="bg-purple-600 px-6 py-2 rounded font-bold">Swap BSO → WBSO</button>
    </div>

    <!-- Add Liquidity -->
    <div class="glass p-6 flex flex-col gap-4">
      <h2 class="text-2xl font-bold text-green-400 mb-2">Add Liquidity</h2>
      <div class="flex gap-4">
        <input type="number" id="liquidityToken" placeholder="BSO Amount" />
        <input type="number" id="liquidityWBSO" placeholder="WBSO Amount" />
      </div>
      <button id="addLiquidityBtn" class="bg-green-600 px-6 py-2 rounded font-bold">Add Liquidity</button>
    </div>

    <!-- Info Panel -->
    <div class="glass p-6 flex flex-col gap-2">
      <h2 class="text-2xl font-bold text-cyan-300">Status</h2>
      <div id="status" class="font-mono text-sm text-cyan-100">Awaiting actions...</div>
    </div>

  </main>

  <!-- Config -->
  <script src="config.js"></script>
  <!-- ABIs -->
  <script src="DemoUSD_ABI.js"></script>
  <script src="WBSO_ABI.js"></script>
  <script src="Router_ABI.js"></script>
  <!-- Main JS -->
  <script>
    let signer, provider;

    async function connectWallet() {
      if(!window.ethereum) return alert("MetaMask not found!");
      try {
        await window.ethereum.request({ method: 'eth_requestAccounts' });
        provider = new ethers.providers.Web3Provider(window.ethereum);
        signer = provider.getSigner();
        const addr = await signer.getAddress();
        document.getElementById("walletAddress").innerText = addr;
        updateStatus("Wallet connected.");
      } catch(err) {
        console.error(err);
        updateStatus("Wallet connection failed.");
      }
    }

    function updateStatus(msg) {
      document.getElementById("status").innerText = msg;
    }

    async function addLiquidity() {
      const tokenAmount = document.getElementById("liquidityToken").value;
      const wbsoAmount  = document.getElementById("liquidityWBSO").value;

      if(!tokenAmount || !wbsoAmount) return alert("Enter valid amounts");

      const token = new ethers.Contract(CONFIG.TOKEN_ADDRESS, DemoUSD_ABI, signer);
      const wbso  = new ethers.Contract(CONFIG.WBSO_ADDRESS, WBSO_ABI, signer);
      const router= new ethers.Contract(CONFIG.ROUTER_ADDRESS, Router_ABI, signer);

      const tAmt = ethers.utils.parseUnits(tokenAmount, 18);
      const wAmt = ethers.utils.parseUnits(wbsoAmount, 18);

      try {
        updateStatus("Approving tokens...");
        await token.approve(CONFIG.ROUTER_ADDRESS, tAmt);
        await wbso.approve(CONFIG.ROUTER_ADDRESS, wAmt);

        updateStatus("Adding liquidity...");
        await router.addLiquidity(
          token.address,
          wbso.address,
          tAmt,
          wAmt,
          0,0,
          await signer.getAddress(),
          Math.floor(Date.now()/1000) + 60*10
        );
        updateStatus("Liquidity added successfully!");
      } catch(err) {
        console.error(err);
        updateStatus("Error adding liquidity.");
      }
    }

    async function swapTokens() {
      const amount = document.getElementById("swapAmount").value;
      if(!amount) return alert("Enter swap amount");

      const token  = new ethers.Contract(CONFIG.TOKEN_ADDRESS, DemoUSD_ABI, signer);
      const router = new ethers.Contract(CONFIG.ROUTER_ADDRESS, Router_ABI, signer);
      const amt    = ethers.utils.parseUnits(amount, 18);

      try {
        updateStatus("Approving token...");
        await token.approve(CONFIG.ROUTER_ADDRESS, amt);

        updateStatus("Swapping...");
        await router.swapExactTokensForTokens(
          amt,
          0,
          [token.address, CONFIG.WBSO_ADDRESS],
          await signer.getAddress(),
          Math.floor(Date.now()/1000)+60*10
        );
        updateStatus("Swap executed successfully!");
      } catch(err) {
        console.error(err);
        updateStatus("Swap failed.");
      }
    }

    // Bind buttons
    window.addEventListener("DOMContentLoaded", ()=>{
      document.getElementById("connectWalletBtn").onclick = connectWallet;
      document.getElementById("addLiquidityBtn").onclick = addLiquidity;
      document.getElementById("swapBtn").onclick = swapTokens;
    });
  </script>

</body>
</html>
