<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>BitSoley Explorer — Transaction</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
<style>
:root{--bg1:#020217;--bg2:#061237;--accent1:#6bc8ff;--accent2:#38f9d7;--muted:#98adc0}
html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg1),var(--bg2));font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;color:#e6f7ff}
.container{max-width:1000px;margin:18px auto;padding:16px}
.header{display:flex;justify-content:space-between;gap:12px;align-items:center;padding:12px;border-radius:12px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.02)}
.brand{font-weight:800;background:linear-gradient(90deg,var(--accent1),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.card{margin-top:12px;padding:14px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.02)}
.small{font-size:13px;color:var(--muted)}
.mono{font-family:ui-monospace,monospace;color:#bfeff8}
.btn{padding:10px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:rgba(255,255,255,0.03);color:var(--accent1);font-weight:700;cursor:pointer}
@media(max-width:800px){ .header{flex-direction:column;align-items:flex-start} }
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div><div class="brand">BitSoley Explorer</div><div class="small">Transaction • RPC: <span id="rpcHost">—</span></div></div>
      <div style="display:flex;gap:8px;align-items:center">
        <button id="connectBtn" class="btn"><i class="fa fa-wallet"></i>&nbsp;<span id="connectLabel">Connect</span></button>
        <button id="addNetworkBtn" class="btn">Add Network</button>
      </div>
    </div>

    <div id="card" class="card">
      <div id="status" class="small">Loading transaction...</div>
      <div id="txArea" style="margin-top:12px"></div>
    </div>
  </div>

<script>
const RPC_BASE = 'https://rpc.bitsoley.com';
const CHAIN_ID_DEC = 216721;
const CHAIN_ID_HEX = '0x34e91';
const SYMBOL = 'BSO';

document.getElementById('rpcHost').innerText = (()=>{ try{return new URL(RPC_BASE).hostname}catch(e){return RPC_BASE}})();

const provider = new ethers.providers.JsonRpcProvider(RPC_BASE);
let walletProvider=null, signer=null, walletAddress=null;
const short = s => s ? (s.slice(0,8)+'…'+s.slice(-6)) : '';
const getBasePath = () => window.location.pathname.includes('/explorer/') ? '/explorer' : '';

/* wallet connect */
async function connectWallet(){ if (window.ethereum){ try{ await window.ethereum.request({method:'eth_requestAccounts'}); walletProvider = new ethers.providers.Web3Provider(window.ethereum); signer = walletProvider.getSigner(); walletAddress = await signer.getAddress(); document.getElementById('connectLabel').innerText = short(walletAddress); }catch(e){console.error(e);alert('MetaMask failed')} return;} try{ const wc = new window.WalletConnectProvider.default({ rpc: { [CHAIN_ID_DEC]: RPC_BASE }, qrcode:true }); await wc.enable(); walletProvider = new ethers.providers.Web3Provider(wc); signer = walletProvider.getSigner(); walletAddress = await signer.getAddress(); document.getElementById('connectLabel').innerText = short(walletAddress); wc.on('disconnect', ()=>{ walletProvider=null; signer=null; walletAddress=null; document.getElementById('connectLabel').innerText='Connect'; }); }catch(e){ console.error(e); alert('WalletConnect failed'); } }
document.getElementById('connectBtn').addEventListener('click', connectWallet);
document.getElementById('addNetworkBtn').addEventListener('click', async ()=>{ if (!window.ethereum) return alert('Install MetaMask'); try{ await window.ethereum.request({ method:'wallet_addEthereumChain', params:[{ chainId: CHAIN_ID_HEX, chainName:'BitSoley', rpcUrls:[RPC_BASE], nativeCurrency:{name:'BitSoley',symbol:SYMBOL,decimals:18}, blockExplorerUrls:[ window.location.origin + getBasePath() ] }]}); alert('Network added'); }catch(e){ console.error(e); alert('Add network failed'); } });

function extractTxHash(){
  const parts = window.location.pathname.split('/').filter(Boolean);
  for (let i=0;i<parts.length;i++){ if (parts[i].toLowerCase()==='tx' && parts[i+1]) return parts[i+1]; }
  const last = parts[parts.length-1]; if (/^0x[0-9a-fA-F]{64}$/.test(last)) return last; return null;
}

const txHash = extractTxHash();
if (!txHash) { document.getElementById('status').innerText = 'No tx hash in URL.'; }
else (async function loadTx(){
  try{
    document.getElementById('status').innerText = 'Fetching transaction...';
    const tx = await provider.getTransaction(txHash);
    if (!tx){ document.getElementById('status').innerText = 'Transaction not found.'; return; }
    const receipt = await provider.getTransactionReceipt(txHash);
    const valueHuman = tx.value ? ethers.utils.formatEther(tx.value) : '0';
    const gasUsed = receipt && receipt.gasUsed ? receipt.gasUsed.toString() : '—';
    const blockNum = tx.blockNumber !== null && tx.blockNumber !== undefined ? tx.blockNumber : 'Pending';
    const html = `
      <div style="display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap">
        <div style="flex:1">
          <div class="small">Hash</div><div class="mono" style="margin-top:6px">${tx.hash}</div>
          <div class="small" style="margin-top:8px">From</div><div class="mono" style="margin-top:6px"><a href="${getBasePath()}/address/${tx.from}">${tx.from}</a></div>
          <div class="small" style="margin-top:8px">To</div><div class="mono" style="margin-top:6px">${tx.to ? `<a href="${getBasePath()}/address/${tx.to}">${tx.to}</a>` : '—'}</div>
        </div>
        <div style="width:260px;text-align:right">
          <div class="small">Value</div><div style="font-weight:800;margin-top:8px">${Number(valueHuman).toFixed(6)} ${SYMBOL}</div>
          <div class="small" style="margin-top:10px">Gas</div><div class="mono" style="margin-top:6px">${tx.gasLimit ? tx.gasLimit.toString() : '—'}</div>
          <div style="margin-top:10px"><button id="copyTx" class="btn">Copy TX</button> <button id="openExt" class="btn">Open</button></div>
        </div>
      </div>

      <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.04)"/>
      <div class="small">Receipt</div>
      <div style="margin-top:8px">${receipt ? `Status: ${receipt.status ? '<span style="color:#9ef8b2">Success</span>' : '<span style="color:#ff9b9b">Fail</span>'} • Block: <a href="${getBasePath()}/block/${blockNum}">${blockNum}</a> • Gas Used: ${gasUsed}` : '<div class="mono">Pending or no receipt</div>'}</div>
    `;
    document.getElementById('txArea').innerHTML = html;
    document.getElementById('status').innerText = '';
    document.getElementById('copyTx').addEventListener('click', ()=> navigator.clipboard.writeText(tx.hash).then(()=>alert('Copied')));
    document.getElementById('openExt').addEventListener('click', ()=> window.open(`${window.location.origin + getBasePath()}/tx/${tx.hash}`));
  }catch(e){ console.error(e); document.getElementById('status').innerText = 'Error: '+(e.message||e); }
})();

</script>
</body>
</html>
